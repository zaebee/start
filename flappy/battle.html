<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Battle ‚Äî –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥</title>
  <style>
    :root{--bg:#0b1324;--card:#0e1b32;--accent:#22c55e;--muted:#9ca3af;--red:#ef4444;--glass:rgba(255,255,255,0.05)}
    html,body{margin:0;padding:0;font-family:Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#060e1a 0%,#0a1222 80%);color:#e6eef8;min-height:100vh}
    .wrap{max-width:960px;margin:auto;padding:20px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    .logo{width:70px;height:70px;border-radius:12px;background:linear-gradient(135deg,#18304a,#0f3b2f);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)}
    h1{margin:0;font-size:24px}
    .lead{color:var(--muted);margin:4px 0 16px}
    canvas{background:#000;border-radius:10px;display:block;margin:20px auto;box-shadow:0 4px 20px rgba(0,0,0,0.6)}
    .controls{text-align:center;margin-top:12px}
    button{background:transparent;color:#e6eef8;border:1px solid rgba(255,255,255,0.2);border-radius:8px;padding:8px 16px;margin:4px;cursor:pointer;transition:.2s}
    button:hover{background:var(--accent);color:#000;border-color:var(--accent)}
    .score{text-align:center;margin-top:10px;font-size:18px;color:var(--accent)}
    footer{text-align:center;margin-top:30px;font-size:13px;color:var(--muted)}
    .instructions{background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;margin-top:30px}
    pre{background:rgba(0,0,0,0.4);padding:10px;border-radius:8px;overflow-x:auto;color:#d1fae5;font-size:14px}
    h2{margin-top:0;color:var(--accent)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">FB</div>
      <div>
        <h1>Flappy Battle ‚Äî –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥</h1>
        <p class="lead">–í–µ–±-–≤–µ—Ä—Å–∏—è –Ω–∞—à–µ–π –∏–≥—Ä—ã Flappy Micro:bit! –£–ø—Ä–∞–≤–ª—è–π –ø—Ç–∏—á–∫–æ–π, –∏–∑–±–µ–≥–∞–π —Ç—Ä—É–±, —Å–æ—Ä–µ–≤–Ω—É–π—Å—è –∑–∞ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π Micro:bit!</p>
      </div>
    </header>

    <canvas id="game" width="320" height="400"></canvas>
    <div class="controls">
      <button id="btnStart">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
      <button id="btnUp">–í–≤–µ—Ä—Ö (Space)</button>
      <button id="btnRestart">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫</button>
      <button id="btnConnect">üîå –ü–æ–¥–∫–ª—é—á–∏—Ç—å Micro:bit</button>
    </div>
    <div class="score">–°—á—ë—Ç: <span id="score">0</span></div>

    <div class="instructions">
      <h2>üß† –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Micro:bit</h2>
      <p>–ß—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ç–∏—á–∫–æ–π —Å –ø–æ–º–æ—â—å—é Micro:bit, –Ω—É–∂–Ω–æ –ø—Ä–æ—à–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫–æ—Ä–æ—Ç–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π. –ö–æ–≥–¥–∞ Micro:bit –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É, –æ–Ω –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä –∫–æ–º–∞–Ω–¥—É <code>UP</code> –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ A –∏–ª–∏ –Ω–∞–∫–ª–æ–Ω–µ –≤–≤–µ—Ä—Ö.</p>

      <h3>üîπ –í–∞—Ä–∏–∞–Ω—Ç 1. MakeCode (JS)</h3>
      <pre>basic.forever(function() {
    if (input.buttonIsPressed(Button.A)) {
        serial.writeLine("UP")
    }
    if (input.acceleration(Dimension.Y) < -200) {
        serial.writeLine("UP")
    }
    basic.pause(100)
})</pre>

      <h3>üîπ –í–∞—Ä–∏–∞–Ω—Ç 2. MicroPython</h3>
      <pre>from microbit import *

while True:
    if button_a.is_pressed() or accelerometer.get_y() < -200:
        uart.write('UP\n')
    sleep(100)</pre>

      <p>–ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <strong>¬´–ü–æ–¥–∫–ª—é—á–∏—Ç—å Micro:bit¬ª</strong> –≤—ã—à–µ. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Chrome / Edge). –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ <strong>¬´–ù–∞—á–∞—Ç—å –∏–≥—Ä—É¬ª</strong> –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ç–∏—á–∫–æ–π –Ω–∞—Å—Ç–æ—è—â–∏–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º!</p>
    </div>

    <footer>
      –£–ø—Ä–∞–≤–ª—è–π —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–±–µ–ª–∞, –∫–Ω–æ–ø–∫–∏ ¬´–í–≤–µ—Ä—Ö¬ª –∏–ª–∏ —á–µ—Ä–µ–∑ Micro:bit. –ü–æ–¥–∫–ª—é—á–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –Ω–∞–∫–ª–æ–Ω –¥–ª—è –ø–æ–ª—ë—Ç–∞! üöÄ
    </footer>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');

    let bird = {x:60,y:150,vy:0,size:16};
    let pipes = [];
    let frame = 0;
    let score = 0;
    let alive = false;
    let running = false;
    let port = null;

	let animationId = null;
	
    function reset() {
	  if (animationId) cancelAnimationFrame(animationId);
	  bird = { x: 60, y: 150, vy: 0, size: 16 };
	  pipes = [];
	  frame = 0;
	  score = 0;
	  alive = true;
	  running = true;
	  scoreEl.textContent = 0;
	  draw();
	  animationId = requestAnimationFrame(update);
	}

    function jump(){
      if(!alive) return;
      bird.vy = -4;
    }

    function update() {
	  if (!running) return;
	  if (!alive) {
		draw();
		return;
	  }

	  frame++;
	  bird.vy += 0.25;
	  bird.y += bird.vy;

	  if (frame % 90 === 0) {
		let gapY = Math.random() * 200 + 80;
		pipes.push({ x: canvas.width, gapY });
	  }

	  pipes.forEach(p => (p.x -= 2));
	  pipes = pipes.filter(p => p.x > -50);

	  pipes.forEach(p => {
		if (p.x + 40 < bird.x && !p.passed) {
		  score++;
		  p.passed = true;
		  scoreEl.textContent = score;
		}
		if (bird.x + bird.size > p.x && bird.x < p.x + 40) {
		  if (bird.y < p.gapY - 50 || bird.y + bird.size > p.gapY + 50) alive = false;
		}
	  });

	  if (bird.y < 0 || bird.y > canvas.height - 20) alive = false;

	  draw();
	  animationId = requestAnimationFrame(update);
	}

    function draw(){
      ctx.fillStyle='#000';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.fillStyle='#22c55e';
      pipes.forEach(p=>{
        ctx.fillRect(p.x,0,40,p.gapY-50);
        ctx.fillRect(p.x,p.gapY+50,40,canvas.height);
      });

      ctx.fillStyle=alive?'#e6eef8':'#ef4444';
      ctx.beginPath();
      ctx.arc(bird.x,bird.y,bird.size/2,0,Math.PI*2);
      ctx.fill();

      if(!alive){
        ctx.fillStyle='#ef4444';
        ctx.font='24px sans-serif';
        ctx.fillText('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞',90,180);
      }
    }

    async function connectMicrobit() {
      if (!('serial' in navigator)) {
        alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Web Serial API. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome –∏–ª–∏ Edge.');
        return;
      }
      try {
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 115200 });
        const decoder = new TextDecoderStream();
        const inputDone = port.readable.pipeTo(decoder.writable);
        const inputStream = decoder.readable;
        const reader = inputStream.getReader();

        alert('Micro:bit –ø–æ–¥–∫–ª—é—á–µ–Ω! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–≥—Ä–æ–π.');

        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          const line = value.trim();
          if (line === 'U') jump();
		  if (line === 'R') reset();
        }
      } catch (err) {
        alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + err);
      }
    }

    document.addEventListener('keydown',e=>{if(e.code==='Space')jump();});
    document.getElementById('btnUp').onclick=jump;
    document.getElementById('btnRestart').onclick=()=>{reset();};
    document.getElementById('btnStart').onclick=()=>{reset();};
    document.getElementById('btnConnect').onclick=connectMicrobit;

    draw();
  </script>
</body>
</html>
